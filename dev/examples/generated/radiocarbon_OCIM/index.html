<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Radiocarbon with OCIM · AIBECS.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link href="../../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../../../index.html"><img class="logo" src="../../../assets/logo.png" alt="AIBECS.jl logo"/></a><h1>AIBECS.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../../">Home</a></li><li><a class="toctext" href="../../../prerequisites/">Prerequisites</a></li><li><span class="toctext">Examples</span><ul><li><a class="toctext" href="../ideal_mean_age/">Ideal mean age</a></li><li><a class="toctext" href="../p_cycle_DIP_DOP_POP/">A Phosphorus Cycling Model</a></li><li class="current"><a class="toctext" href>Radiocarbon with OCIM</a><ul class="internal"></ul></li><li><a class="toctext" href="../tracer_transport_operators/">Tracer Transport Operators</a></li></ul></li><li><a class="toctext" href="../../../functions/">Function index</a></li></ul></nav><article id="docs"><header><nav><ul><li>Examples</li><li><a href>Radiocarbon with OCIM</a></li></ul><a class="edit-page" href="https://github.com/briochemc/AIBECS.jl/blob/master/docs/src/examples/generated/radiocarbon_OCIM.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Radiocarbon with OCIM</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Radiocarbon-with-OCIM-1" href="#Radiocarbon-with-OCIM-1">Radiocarbon with OCIM</a></h1><div class="admonition tip"><div class="admonition-title">Tip</div><div class="admonition-text"><p>This example is also available as a Jupyter notebook: <a href="https://nbviewer.jupyter.org/github/briochemc/AIBECS.jl/blob/gh-pages/dev/examples/generated/radiocarbon_OCIM.ipynb"><code>radiocarbon_OCIM.ipynb</code></a></p></div></div><p>A simple model for <span>$R \equiv \frac{^{14}\mathrm{C}}{^{12}\mathrm{C}}$</span> normalized so that <span>$R=1$</span> in the atmosphere.</p><div>\[\frac{\partial R}{\partial t} + [\mathbf{TRdiv}]R = \kappa\boldsymbol{\Lambda}(1-R) -\lambda R\]</div><p>Here we will redo the radiocarbon age example, but using the OCIM1 transport operator made available through the AIBECS package</p><pre><code class="language-julia">using AIBECS
mask, grd, T_OCIM = OCIM1.load() ;</code></pre><p>Some useful OCIM stuff</p><pre><code class="language-julia">iwet = findall(vec(mask))       # index to wet grdboxes
h = ustrip(grd.δdepth[1])     # thickness of the top layer
z = ustrip.(grd.depth_3D[iwet]) # depth of the grdbox centers
nwet = length(iwet)             # number of wet grd boxes
v = vector_of_volumes(mask,grd)# volume of the grdboxes
lat, lon = ustrip.(grd.lat), ustrip.(grd.lon) # latitudes and longitudes (useful for plotting)
depth = ustrip.(grd.depth) ;</code></pre><p>Make a table of parameters</p><pre><code class="language-julia">t = empty_parameter_table()               # initialize table of parameters
add_parameter!(t, :λ, 1 / (5730*log(2))u&quot;yr&quot;) # add the radioactive decay e-folding timescale
add_parameter!(t, :κ, 50u&quot;m&quot; / 10u&quot;yr&quot;)
add_parameter!(t, :z₀, 20u&quot;m&quot;)
initialize_Parameters_type(t, &quot;C14_Parameters&quot;) # Generate the parameter table</code></pre><p>The model parameters</p><pre><code class="language-julia">p = C14_Parameters()</code></pre><p>The sources and sinks of <span>$R$</span></p><pre><code class="language-julia">function sms(R, p)
    λ, κ, z₀ = p.λ, p.κ, p.z₀
    return κ / h * (z .&lt; z₀) .* (1.0 .- R) - λ * R
end</code></pre><p>The tracer transport operator</p><pre><code class="language-julia">T_14c(p) = T_OCIM</code></pre><p>Prepare the stuff needed for the AIBECS solver:</p><pre><code class="language-julia">T_matrices = (T_14c,)            # bundles all the transport matrices in a tuple
sources_minus_sinks = (sms,) # bundles all the source-sink functions in a tuple
F, ∇ₓF = state_function_and_Jacobian(T_matrices, sources_minus_sinks, nwet) # generates the state function (and its Jacobian!)</code></pre><pre><code class="language-julia">x = ones(nwet)                           # initial iterate for the solver
prob = SteadyStateProblem(F, ∇ₓF, x, p) # define the problem
R = solve(prob, CTKAlg())                 # solve the problem
c14age = -log.(R) / p.λ ;                   # convert R to $^{14}C-age$</code></pre><p>Make some plots</p><pre><code class="language-julia">c14age_3d = fill(NaN, size(mask))     # creates a 3D array of NaNs
c14age_3d[iwet] = c14age   # Fills the wet grd boxes with the age values
size(c14age_3d)            # Just to check the size of age_3D</code></pre><p>Pick a layer to plot</p><pre><code class="language-julia">iz = findfirst(depth .&gt; 700) # aim for a depth of ~ 700 m
depth_map = Int(round(depth[iz]))
iz, depth_map
c14age_3d_1000m_yr = c14age_3d[:,:,iz] * ustrip(1.0u&quot;s&quot; |&gt; u&quot;yr&quot;)</code></pre><pre><code class="language-julia">ENV[&quot;MPLBACKEND&quot;]=&quot;qt5agg&quot;
using PyPlot, PyCall</code></pre><pre><code class="language-julia">clf()
ccrs = pyimport(&quot;cartopy.crs&quot;)
ax = subplot(projection=ccrs.EqualEarth(central_longitude=-155.0))
ax.coastlines()
lon_cyc = [lon; 360+lon[1]] # making it cyclic for Cartopy
age_cyc = hcat(c14age_3d_1000m_yr, c14age_3d_1000m_yr[:,1])
p = contourf(lon_cyc, lat, age_cyc, levels=0:100:1800, transform=ccrs.PlateCarree(), zorder=-1)
colorbar(p, orientation=&quot;horizontal&quot;)
title(&quot;¹⁴C age at $(depth_map)m depth&quot;)
gcf() # gets the current figure to display</code></pre><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../p_cycle_DIP_DOP_POP/"><span class="direction">Previous</span><span class="title">A Phosphorus Cycling Model</span></a><a class="next" href="../tracer_transport_operators/"><span class="direction">Next</span><span class="title">Tracer Transport Operators</span></a></footer></article></body></html>
